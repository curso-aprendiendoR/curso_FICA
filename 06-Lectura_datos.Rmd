# Lectura de Datos

En este cap칤tulo revisaremos una tabla de datos extensa de la cual obtendremos varios resultados con varias herramientas que ya conocemos y algunas nuevas

R contiene una librer칤a con datos reales que pueden ser usados, para acceder a ella debemos instalar el paquete **datasets** y escribir el comando `datasets::`y pulsar el tabulador; esta librer칤a te ser치 muy 칰til para practicar. 

En esta clase no utilizaremos los datos de la librer칤a de `R`, sino que cargaremos un documento tipo csv de datos de becarios del SENECYT.

Para cargar datos csv en `R` escribimos el comando `read.csv()`, en el argumento colocaremos el directorio del archivo, sin embargo si el archivo se encuentra en la misma carpeta del proyecto basta con colocar el nombre del archivo y la extensi칩n del mismo. 

Ahora si el archivo de datos es de tipo **xlsx** primero deber치s instalar el paquete `readxl` y ejecutar el comando `read_excel()`

```{r}
#Carguemos y almacenemos el archivo
incendio<- read.csv("./documentos/maate_incendio.csv")
```

Si queremos observar la tabla de datos podemos acceder a trav칠s del panel de entorno o con el comando `View()`

```{r, eval=FALSE}
View(incendio)
```

Si quisi칠ramos ver parcialmente la informaci칩n que tenemos podemos visualizar las 6 primeras filas de datos con el comando `head()`, tambi칠n podemos visualizar las 6 칰ltimas filas con el comando `tail()`.

```{r}
# Visualizaci칩n de las 6 primeras filas de datos
head(incendio)

#Visualizaci칩n de las 칰ltimas 6 filas y columnas 7, 9 y 16
tail(incendio[,c(7,9,16)])
```

El comando `summary()` es una excelente manera de hacer una inspecci칩n inicial de una base de datos, este comando permite obtener un resumen de la informaci칩n a trav칠s de un reporte de estad칤stica descriptiva

```{r}
summary(incendio)
```

Ahora revisemos la dimensi칩n de la tabla de datos `dim()`. 쮺u치ntos registos tengo (n칰mero de filas) `nrow()` y cuantas variables registradas (n칰mero de columnas) `ncol()`? y 쯥i quiesiera saber el nombre de las variables `colnames()`?

```{r}
dim(incendio)
nrow(incendio)
ncol(incendio)
colnames(incendio)
```

Ahora modifiquemos nuestro data frame de ejemplo para dejar 칰nicamente las variables m치s relevantes

Vamos a eliminar todos los datos de la operadora y practicaremos varias maneras de realizarlo.

```{r}
# Vamos con la m치s sencilla
incendio<- incendio[,-11]
```

Ahora practicaremos un comando de mucha utilidad `which()` este comando nos permite encontrar 칤ndices (es decir el n칰mero de orden) correspondientes a variables que cumplan con ciertas caracter칤ticas.

```{r}
which(colnames(incendio)=="DPA_PROVIN")

#Ahora vamos a eliminar esta columna
#Primero almacenar칠 el 칤ndice de la variable a eliminar
borrar<- which(colnames(incendio)=="DPA_PROVIN")
#Ahora eliminamos la columna DPA_PROVIN
incendio<- incendio[,-borrar]
```

Ahora eliminaremos las columnas que en el nombre tengan la palabra OPERADORA. Utilizaremos el comando `grepl()`, este comando busca comulnas con una caracteritica especifica, en el argumento colocaremos dos items:
1. El patr칩n a buscar
2. En donde buscarmenos el patr칩n

**grepl** nos dar치 como resultado una veariable l칩gica indic치ndonos si cumple o no con la condici칩n. Si observas bien el caso en el que borramos la columna TIPO_OPERADORA, te dar치s cuenta que antes de encontrar el 칤ndice encontramos un valor l칩gico. De manera similar realizaremos este caso

```{r}
#Vamos paso a paso
#Primero obtendremos la variable l칩gica 
grepl("dpa", colnames(incendio), 
      ignore.case =TRUE)
#He colocado un tercer item para indicar que no considere may칰sculas y min칰sculas

#Ahora buscaremos el indicador y lo almacenaremos
borrar_2<- which(grepl("dpa",colnames(incendio), ignore.case = TRUE))

#Finalmente lo eliminaremos
incendio<- incendio[,-borrar_2]

#Hasta ahora el data frame se ve as칤
head(incendio)
```

Recordemos que cuando observamos el resumen de variables nos indicaba que la fecha es tipo caracter, vamos a cambiar a tipo fecha, agregaremos una columna de hora que importaremos de un archivo csv y uniremos estas dos variables en una sola columna. Aqu칤 practicaremos como agregar una nueva columna al data frame, uniremos dos datos en una sola columna, transformaremos a fecha y eliminaremos las columnas que ya han sido unificadas.

```{r}
#cargamos un archivo tipo csv en un nuevo data frame
Hora<-read.csv("./documentos/hora.csv", header = FALSE)
#Unimos dos data frame
incendio<- cbind(incendio,Hora)
#Cambiamos el nombre de la columna agregada
colnames(incendio)[13]<- "ALERTA_HORA"
incendio$Fecha_Hora<-paste(incendio$ALERTA_FECHA, incendio$ALERTA_HORA)
incendio$Fecha_Hora<- as.POSIXct(incendio$Fecha_Hora, format= "%m/%d/%Y %H:%M:%OS")
#Borraremos las columnas que ya no necesitamos
incendio<- incendio[,which(!grepl("ALERTA",colnames(incendio)))]
```

Observe que cuando eliminamos las columnas de fecha y hora, a la estructura le agregamos **!** y si somos observadores tambi칠n identificaremos que quitamos **-**; esto se debe a que el signo **!** es utilizado como negaci칩n.

쮺칩mo ha quedado el data frame hasta el momento?

```{r}
head(incendio)

summary(incendio)
```

Al observar el resumen del data frame, observamos que el la columna de 치rea tenemos a NA, estos casilleros no tiene datos. Ahora supongamos que queremos eliminar las filas que no tienen datos de 치rea afectada. (Ojo: No siempre se deber치 borrar las filas que no tienen datos, depender치 del an치lisis que se quiera hacer)

```{r}
incendio<- na.omit(incendio)
```

Para el manejo de data frame tenemos una herramienta muy potente: la funci칩n `subset()`. Dicha funci칩n permitir seleccionar filas y columnas a la vez, de la siguiente manera: 

**x**: Data frame de entrada.
**subset**: condici칩n l칩gica que queramos usar para seleccionar las filas.
**select**: un vector que contenga el nombre de las columnas que queremos seleccionar (este argumento es necesario si queremos filtrar filas y columnas).

En nuestro ejemplo vamos a buscar datos de la provincia y el cant칩n que tengan 치rea de afectaci칩n mayor a 5 kil칩metros cuadraros y que estas 치reas afectadas sean parte del Sistema Nacional de 츼reas Protegidas snap. 

```{r}
#Primero pasameros de HA a km2

incendio$AREA_KM2 = incendio$AREA_HA * 0.01

#Ahora obtenemos los datos solicitados

subset(incendio, subset = AREA_KM2 > 5 & CAT_CRUCE == "snap", select = c(PROVINCIA, CANTON))
```


## 游닇 Ejercicio

Del paquete `datasets` almacene el conjunto de datos llamado **airquality** y obtenga los siguientes resultados. (Recuerde utilizar las herramientas que hemos aprendido, tamb칤en puede buscar otro camino, pero siempre a trav칠s de codificaci칩n)

1. En un data frame llamado **calidad_mayo** extraiga las 6 variables medidas para el mes de mayo. 
2. Elimine del data frame **calidad_mayo** las filas que contengan NA en cualquiera de las variables
3. De la informaci칩n que le qued칩 en **calidad_mayo** alamacene unicamente las filas en donde la velocidad el viento sea mayor a 10 y la temperatura menor a 70.
4. Calcule cuantas filas quedaron descartadas despu칠s de depurar la informaci칩n de mayo. 
5. Traduzque y Cambie los nombres de las columnas del data frame final de **calidad_mayo**
6. A침ada a los datos de mayo una columna con la fecha completa (recuerde que todas las observaciones son del a침o es del a침o 1973)